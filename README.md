# kiber-api

Многоуровневый серверный проект, включающий набор микросервисов для поддержки экосистемы **KIBERmobile** и связанных сервисов.

---

## Архитектура
Четыре автономных микросервиса. Каждый можно развёртывать и масштабировать независимо:

- **db-api** — работа с СУБД (MySQL).
- **gate-api** — API‑шлюз/прокси между клиентами и внутренними сервисами.
- **mailer-api** — отправка писем и уведомлений.
- **static-api** — отдача статического контента.

Стандарт взаимодействия между сервисами — HTTP/JSON.

---

## Единые требования
- **Node.js**: рекомендовано **>= 16.14** (совместимо с цепочками зависимостей всех модулей).
- **npm**: lockfile v3.
- **ОС**: Linux/Windows/macOS.
- Для **db-api** требуется доступ к **MySQL**.

---

## Технологический стек по модулям

### db-api
- Рантайм: **Node.js** (>= 16.14)
- Веб‑фреймворк: **Express 4.19.2**
- База данных: **MySQL** (клиент **mysql2 3.10.1**)
- CORS: **cors 2.8.5**

Ключевые зависимости: `express`, `mysql2`, `cors`.

Переменные окружения (пример): `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`.

---

### gate-api
- Рантайм: **Node.js** (рек. >= 16.14)
- Веб‑фреймворк: **Express 4.19.2**
- HTTP‑клиент: **node-fetch 3.3.2** (ESM‑only)

Ключевые зависимости: `express`, `node-fetch`.

Примечание: `node-fetch@3` — ESM‑модуль. Нужен `"type": "module"` в `package.json` или динамический `import()`.

Переменные окружения (пример): `UPSTREAM_BASE_URL`, `API_KEY`.

---

### mailer-api
- Рантайм: **Node.js** (рек. >= 16.14)
- Веб‑фреймворк: **Express 4.19.2**
- Почта: **Nodemailer 6.9.14**

Ключевые зависимости: `express`, `nodemailer`.

Переменные окружения (пример): `MAIL_HOST`, `MAIL_PORT`, `MAIL_USER`, `MAIL_PASSWORD`, `MAIL_FROM`.

---

### static-api
- Рантайм: **Node.js** (рек. >= 16.14)
- Веб‑фреймворк: **Express 4.19.2**
- Отдача статики: **serve-static 1.15.0** (идёт в цепочке зависимостей)

Ключевые зависимости: `express`, `serve-static`.

Переменные окружения (пример): `STATIC_ROOT`, `STATIC_CACHE_MAXAGE`.

---

## Структура репозитория
```
kiber-api/
 ├── db-api/        # сервис доступа к БД (MySQL)
 ├── gate-api/      # API‑шлюз/прокси
 ├── mailer-api/    # сервис отправки писем
 └── static-api/    # отдача статического контента
```

---

## Запуск (общая схема)
Для каждого сервиса:
1. Перейти в каталог сервиса: `cd <service>`
2. Установить зависимости: `npm install`
3. Экспортировать переменные окружения (см. разделы выше)
4. Запустить сервер (пример): `node ./index.js`

> Имена стартовых файлов могут отличаться — используйте фактический entry‑point сервиса.

---

## Рекомендации по продакшену
- Логирование: JSON‑логи, ротация и сбор через системный агент/агрегатор.
- Сетевые таймауты и ретраи для **gate-api** (исходящие запросы).
- Пулы подключений и таймауты для **db-api**.
- Кэш‑заголовки и `ETag` для **static-api**.
- Хранение секретов (SMTP, ключи, пароли БД) через секрет‑менеджер.
- Здоровье сервисов: `/health` и `/ready` эндпоинты.

---

## Ограничения публикации
Проект является прототипом, положенным в основу реального внутреннего продукта и **принадлежит автору**. Публично могут выкладываться **только отдельные фрагменты исходного кода** для демонстрации архитектурных подходов и навыков. Полная публикация исходников или использование кода без **явного разрешения автора** запрещены.

---

## Автор
Danil Gelimyanov

---

## Лицензия
Код проекта принадлежит автору. Использование без разрешения запрещается.
